import React        from 'react'
import OnSubmit     from './_examples/OnSubmit'
import OnSubmitSrc  from './_examples/OnSubmit.tsx?raw'
import Throw        from './_examples/Throw'
import ThrowSrc     from './_examples/Throw.tsx?raw'
import Reject       from './_examples/Reject'
import RejectSrc    from './_examples/Reject.tsx?raw'
import Taken        from './_examples/Taken'
import TakenSrc     from './_examples/Taken.tsx?raw'
import Errors       from './_examples/Errors'
import ErrorsSrc    from './_examples/Errors.tsx?raw'
import SeeAlso      from '@/site/SeeAlso.jsx'
import TryItOut     from '@/website/site/TryItOut.jsx'
import TSNotes      from '@/ui/TSNotes'
import { Example, Split } from '@abw/badger-website'
import { ErrorsFieldErrorsLink, ErrorsLink, FormOnErrorLink, FormOnSuccessLink } from '@/site/Links.jsx'

## `onSubmit`

The `onSubmit` property can be used to define a function
that will be called when the form is submitted and has passed all the
relevant validation checks.

In most cases this function will be making an API call to submit the
form data.  The form values are passed to the function as the first
argument (if you're using Typescript the type is `FieldValues`).  The
second argument is an object containing the form context in case you need
it (type is `FormObject`).

<Example
  Component={OnSubmit}
  code={OnSubmitSrc}
  caption="onSubmit"
  highlightLines="9-12,15"
  expand
/>

## Server Error

<Split align="end">
  <div>
    In many cases the `onSubmit` handler will be an
    asynchronous function which makes an API call.  The server should
    implement server-side form validation and may need to return a
    response indicating problems with the submitted fields.

    If an `onSubmit` handler throws an error then it will be
    stored as the `error` property in the form state{' '}.
    The <ErrorsLink/> component can be used to display errors.
  </div>
  <TryItOut>
    Try submitting the form.  The `onSubmit` handler throws
    an error which will be displayed by the <ErrorsLink/> component.
  </TryItOut>
</Split>

<Example
  Component={Throw}
  code={ThrowSrc}
  caption="onSubmit Throw"
  highlightLines="4"
  expand
/>

An `onSubmit` handler can also return a rejected Promise.
It should be an object containing an `error` property.

<Example
  Component={Reject}
  code={RejectSrc}
  caption="onSubmit Reject"
  highlightLines="4-6"
  expand
/>

## Field Errors

The `onSubmit` handler can return an `errors` object
as a rejected Promise. This can be an object in which the keys correspond
to field names and the values are the error messages for the fields.

The error messages will be set and displayed in the appropriate fields.
You can also use the <ErrorsLink/> component with the{' '}
<ErrorsFieldErrorsLink/> property to display them.

<Example
  Component={Taken}
  code={TakenSrc}
  caption="onSubmit errors"
  highlightLines="7-11"
  expand
/>

Alternately, the `errors` returned can be an array of objects.
Each object should have a `name`, `field` or{' '}
`param` property to identify the field name, and either an{' '}
`message` or `error` string to provide the error.

<Example
  Component={Errors}
  code={ErrorsSrc}
  caption="onSubmit errors"
  highlightLines="7-20"
  expand
/>

<TSNotes>
The type of the form `onSubmit` handler is `FormSubmitHandler`.  It receives
the field values (`FieldValues`) as the first argument and the form context
object (`FormObject`) as the second.  It should return a `FormSubmitResponse`
or a promise that returns a `FormSubmitResponse`.  The `FormSubmitResponse`
is an object that should contain either a boolean `ok` flag or a numerical
http `status`, where any value between 200 and 299 is considered a successful
response.  It may also contain an object of additional `data`.  This is
compatible with the response returned by Axios or the native `fetch` function.
</TSNotes>

<SeeAlso
  links={[
    FormOnSuccessLink,
    FormOnErrorLink
  ]}
/>
